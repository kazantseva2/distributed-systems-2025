# Высоконагруженный сервис отзывов и рейтингов для е-cоmmerсе (Проект А5)

## Описание проекта

Сервис для сбора, хранения и анализа отзывов о товарах интернет-магазина.  
Проект ориентирован на **высокие нагрузки** во время акций и распродаж, когда тысячи пользователей одновременно читают и пишут отзывы.

### Технологический стек
- **Java**
- **Spring Boot**
- **MongoDB** — основное хранилище данных.
- **Hazelcast** — кэширование агрегированных данных и rate limiting.
- **OpenSearch** — полнотекстовый поиск и аналитика.
- **REST API** — взаимодействие с клиентами и сервисами.

---

## Сценарии работы

### 1. Добавление нового отзыва

**Цель:**  
Пользователь оставляет отзыв о товаре.

**Основной поток:**
1. Пользователь отправляет запрос `POST /api/products/{productId}/reviews`.
2. Система проверяет:
   - Авторизован ли пользователь.
   - Существует ли товар.
3. Создаётся новый документ в коллекции `reviews`.
4. Пересчитывается агрегированный рейтинг и количество отзывов для `productId`.
5. Обновляются данные в:
   - Коллекции `products`;
   - Кэше Hazelcast (`product_summary_cache`);
   - Статистике пользователя (`reviewsCount`).

**Исключения:**
- Отзыв уже существует от этого пользователя → `HTTP 400`.

---

### 2. Получение отзывов с фильтрацией

**Цель:**  
Показать список отзывов для конкретного товара с возможностью фильтрации и сортировки.

**Основной поток:**
1. Пользователь отправляет `GET /api/products/{productId}/reviews?rating=4&hasText=true&sortBy=date`.
2. Система выполняет поиск в MongoDB с фильтрами:
   - `productId`
   - `rating` (опционально)
   - `ratingOp` (опционально)
   - `hasText = true` (только отзывы с текстом)
   - `moderationStatus = APPROVED`
3. Возвращает список отзывов, отсортированный по указанному параметру.

---

### 3. Получение агрегированных данных по товару

**Цель:**  
Быстро получить средний рейтинг и количество отзывов.

**Основной поток:**
1. Клиент делает запрос `GET /api/products/{productId}/summary`.
2. Система проверяет Hazelcast-кэш.
3. Если кэш пуст:
   - Данные берутся из MongoDB (`products`);
   - Результат сохраняется в кэш на 10 минут.
4. Возвращается JSON с `aggregatedRating` и `countReviews`.

### 4. Модерация отзывов

**Цель:**  
Администратор проверяет и утверждает или отклоняет отзыв.

**Основной поток:**
1. Запрос `POST /api/reviews/{reviewId}/moderate`.
2. Модератор передаёт новый статус (`APPROVED` / `REJECTED`).
3. Система обновляет поле `moderationStatus` в документе `reviews`.
4. Если отзыв одобрен:
   - Пересчитывается агрегированный рейтинг товара;
   - Обновляется кэш Hazelcast.

---

### 5. Регистрация пользователя

**Цель:**  
Создать нового пользователя в системе.

**Основной поток:**
1. Запрос `POST /api/users/register`.
2.Создаётся документ `User`.
4. Сохраняется в коллекции `users`.

---

### 6. Просмотр профиля пользователя

**Цель:**  
Получить информацию о пользователе.

**Основной поток:**
1. Запрос `GET /api/users/{userId}`.
2. Система находит пользователя в MongoDB.
3. Возвращает:
   - `name`
   - `reviewsCount`

---

### 7. Удаление пользователя и его отзывов

**Цель:**  
Полное удаление профиля.

**Основной поток:**
1. Запрос `DELETE /api/users/{userId}`.
2. Удаляется документ пользователя.
3. Удаляются все отзывы, где `userId = {userId}`.
4. Обновляются агрегированные рейтинги товаров, где были его отзывы.

---

### 8. Добавление продукта

**Цель:**  
Добавить новый товар в каталог.

**API:**  
`POST /api/products`

---

### 9. Удаление продукта со всеми отзывами

**Цель:**
Удалить товар и все связанные отзывы.

**API:**
`DELETE /api/products/{productId}`

---

### 10. Удаление отзыва

**Цель:**
Удалить отзыв пользователя или администратором.

**API:**  
- Пользователь: `DELETE /api/products/{productId}/reviews/{reviewId}`
- Администратор: `DELETE /api/reviews/{reviewId}`




